<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ”® å¡”ç½—ç‰Œå åœ â€“ çˆ±æƒ…Â·äº‹ä¸šÂ·å® ç‰©Â·äº²æƒ…</title>
  <style>
    :root{--bg:#0f1724;--card-back:#0b2536;--card-front:#fff;--accent:#f59e0b}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans CJK SC', 'PingFang SC', 'Hiragino Sans GB', "Microsoft YaHei", sans-serif;background:linear-gradient(180deg,#071020 0%, #0f1724 60%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:1000px}
    header{margin-bottom:20px}
    h1{font-size:20px;margin:0;color:var(--accent)}
    p.desc{margin:6px 0 0;color:#a9bfd6;font-size:13px}

    .tag-selector{background:rgba(255,255,255,0.02);padding:20px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.7);margin-bottom:20px}
    .tag-title{font-size:14px;color:#cfe6ff;margin-bottom:12px;font-weight:500}
    .tag-buttons{display:flex;gap:10px;flex-wrap:wrap}
    .tag-btn{padding:10px 16px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:inherit;cursor:pointer;transition:all 200ms ease;font-size:14px}
    .tag-btn:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.2)}
    .tag-btn.active{background:var(--accent);color:#062024;border-color:var(--accent);font-weight:600}

    .board{background:rgba(255,255,255,0.02);padding:24px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.7)}
    .controls{display:flex;gap:12px;align-items:center;margin-bottom:18px;flex-wrap:wrap}
    button{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;color:inherit;cursor:pointer;font-size:14px;transition:all 200ms}
    button:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.2)}
    button:disabled{opacity:0.5;cursor:not-allowed}
    button.primary{background:var(--accent);color:#062024;border:none;box-shadow:0 6px 18px rgba(245,158,11,0.12);font-weight:600}
    button.primary:hover:not(:disabled){background:#f8b92e}

    .music-control{display:flex;gap:8px;align-items:center;padding:8px 12px;background:rgba(245,158,11,0.1);border:1px solid var(--accent);border-radius:8px;font-size:13px}
    .music-control button{padding:6px 10px;font-size:12px}

    .spread{display:flex;gap:18px;justify-content:center;align-items:flex-end;padding:20px 10px;flex-wrap:wrap}
    .card{width:150px;height:230px;perspective:1100px;cursor:pointer}
    .card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 700ms cubic-bezier(.2,.9,.2,1)}
    .card.flipped .card-inner{transform:rotateY(180deg)}
    .card-face{position:absolute;inset:0;border-radius:10px;display:flex;align-items:center;justify-content:center;backface-visibility:hidden;box-shadow:0 8px 18px rgba(2,6,23,0.6)}
    .card-back{background:linear-gradient(135deg,var(--card-back),#072033);border:1px solid rgba(255,255,255,0.04);color:#fff;font-weight:700;letter-spacing:2px;font-size:32px}
    .card-front{transform:rotateY(180deg);background:linear-gradient(180deg,#fff,#f4f7fb);color:#072033;padding:12px;flex-direction:column;overflow:hidden;position:relative}
    .card-image{width:100%;height:70%;object-fit:cover;border-radius:4px;margin-bottom:6px}
    .card-title{font-weight:700;font-size:12px;text-align:center;line-height:1.2;flex:1;display:flex;align-items:center;justify-content:center}

    @media (max-width:768px){
      .app{max-width:100%;padding:16px}
      header{margin-bottom:16px}
      h1{font-size:18px}
      .tag-selector{padding:16px;margin-bottom:16px}
      .board{padding:16px}
      .card{width:120px;height:190px}
      .card-image{height:65%}
      .card-title{font-size:11px}
      .spread{gap:12px;padding:16px 8px}
      button{padding:8px 12px;font-size:13px}
      .hint{font-size:12px;line-height:1.5}
      .reading-content{font-size:13px}
    }

    .hint{margin-top:12px;color:#9fb4d8;font-size:13px;text-align:center}

    .log{margin-top:18px;background:rgba(255,255,255,0.02);padding:14px;border-radius:8px;color:#cfe6ff;min-height:60px;display:flex;align-items:center;justify-content:center;text-align:center}

    .reading{margin-top:20px;background:linear-gradient(135deg,rgba(245,158,11,0.05),rgba(124,58,202,0.05));padding:18px;border-radius:12px;border-left:4px solid var(--accent);display:none}
    .reading.show{display:block;animation:slideIn 500ms ease}
    @keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .reading-title{font-size:16px;font-weight:700;color:var(--accent);margin-bottom:12px}
    .reading-content{line-height:1.6;color:#d9e6f7;font-size:14px}

    footer{margin-top:12px;text-align:center;color:#7d96b3;font-size:12px}

    .image-input{display:none}
    .upload-hint{font-size:12px;color:#7d96b3;margin-top:8px}

    @media (max-width:640px){
      .card{width:110px;height:170px}
      .spread{gap:12px}
      .tag-buttons{gap:8px}
      .tag-btn{padding:8px 12px;font-size:13px}
      .music-control{flex-direction:column;gap:6px}
    }
  </style>
</head>
<body>
  <!-- èƒŒæ™¯éŸ³ä¹ -->
  <audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <div class="app">
    <header>
      <h1>ğŸ”® å¡”ç½—ç‰Œå åœ</h1>
      <p class="desc">é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼ŒæŠ½å–ä¸‰å¼ ç‰Œæ¢ç´¢ä½ çš„è¿‡å»ã€ç°åœ¨ä¸æœªæ¥</p>
    </header>

    <div class="tag-selector">
      <div class="tag-title">è¯·é€‰æ‹©å åœä¸»é¢˜ï¼š</div>
      <div class="tag-buttons">
        <button class="tag-btn" data-tag="love">ğŸ’— çˆ±æƒ…</button>
        <button class="tag-btn" data-tag="career">ğŸ’¼ äº‹ä¸š</button>
        <button class="tag-btn" data-tag="pet">ğŸ¾ å® ç‰©</button>
        <button class="tag-btn" data-tag="family">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ äº²æƒ…</button>
      </div>
    </div>

    <main class="board">
      <div class="controls">
        <button id="shuffle">ğŸ”„ æ´—ç‰Œ</button>
        <button id="draw" class="primary">âœ¨ æŠ½ç‰Œ</button>
        <button id="revealAll">ğŸ‘ï¸ å…¨éƒ¨ç¿»å¼€</button>
        <button id="reset">â†» é‡æ–°å¼€å§‹</button>
        <div style="flex:1"></div>
        <div class="music-control">
          <span id="musicStatus">ğŸµ</span>
          <button id="musicBtn" style="padding:6px 10px;font-size:12px">ğŸ”Š éŸ³ä¹</button>
        </div>
        <div style="font-size:13px;color:#9fb4d8" id="tagDisplay"></div>
      </div>

      <div class="spread" id="spread">
        <div class="card" data-pos="past">
          <div class="card-inner">
            <div class="card-face card-back">ğŸ´</div>
            <div class="card-face card-front">
              <img class="card-image" src="" alt="card" />
              <div class="card-title">æœªç¿»å¼€</div>
            </div>
          </div>
        </div>

        <div class="card" data-pos="present">
          <div class="card-inner">
            <div class="card-face card-back">ğŸ´</div>
            <div class="card-face card-front">
              <img class="card-image" src="" alt="card" />
              <div class="card-title">æœªç¿»å¼€</div>
            </div>
          </div>
        </div>

        <div class="card" data-pos="future">
          <div class="card-inner">
            <div class="card-face card-back">ğŸ´</div>
            <div class="card-face card-front">
              <img class="card-image" src="" alt="card" />
              <div class="card-title">æœªç¿»å¼€</div>
            </div>
          </div>
        </div>
      </div>

      <div class="hint">
        <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        1ï¸âƒ£ å…ˆé€‰æ‹©å åœä¸»é¢˜<br>
        2ï¸âƒ£ ç‚¹å‡»"æ´—ç‰Œ"å‡†å¤‡ï¼ˆæˆ–ç›´æ¥ç‚¹å‡»"æŠ½ç‰Œ"ï¼‰<br>
        3ï¸âƒ£ ç‚¹å‡»"æŠ½ç‰Œ"æˆ–å•ä¸ªå¡ç‰Œç¿»å¼€æŸ¥çœ‹<br>
        4ï¸âƒ£ ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå åœè§£è¯»
      </div>

      <div class="log" id="log">å‡†å¤‡å°±ç»ª â€“ é€‰æ‹©ä¸»é¢˜åå¼€å§‹å åœ</div>

      <div class="reading" id="reading">
        <div class="reading-title">ğŸ“– å åœè§£è¯»</div>
        <div class="reading-content" id="readingContent"></div>
      </div>

      <footer>ä»…ä¾›å¨±ä¹ â€“ éä¸“ä¸šå åœ</footer>
    </main>
  </div>

  <script>
    // 78å¼ å®Œæ•´å¡”ç½—ç‰Œæ•°æ®
    const ALL_CARDS = [
      {id:0,name:'æ„šè€…',desc:'æ–°çš„å¼€å§‹ã€è‡ªç”±ã€å†’é™©'},
      {id:1,name:'é­”æœ¯å¸ˆ',desc:'æ„å¿—ã€åˆ›é€ ã€èµ„æºæ•´åˆ'},
      {id:2,name:'å¥³ç¥­å¸',desc:'ç›´è§‰ã€æ½œæ„è¯†ã€ç­‰å¾…'},
      {id:3,name:'å¥³çš‡',desc:'å­•è‚²ã€ä¸°ç››ã€å…³æ€€'},
      {id:4,name:'çš‡å¸',desc:'ç»“æ„ã€æƒå¨ã€ç¨³å®š'},
      {id:5,name:'æ•™çš‡',desc:'ä¼ ç»Ÿã€æŒ‡å¯¼ã€ä¿¡å¿µ'},
      {id:6,name:'æƒ…äºº',desc:'é€‰æ‹©ã€å…³ç³»ã€å’Œè°'},
      {id:7,name:'æˆ˜è½¦',desc:'æ„å¿—ã€æŒæ§ã€èƒœåˆ©'},
      {id:8,name:'åŠ›é‡',desc:'å‹‡æ°”ã€è€å¿ƒã€å…‹åˆ¶'},
      {id:9,name:'éšè€…',desc:'å†…çœã€å¯»æ±‚ã€è‡ªæˆ‘æ¢ç´¢'},
      {id:10,name:'å‘½è¿ä¹‹è½®',desc:'å‘¨æœŸã€å˜åŒ–ã€æœºé‡'},
      {id:11,name:'æ­£ä¹‰',desc:'å…¬å¹³ã€å› æœã€å†³å®š'},
      {id:12,name:'å€’åŠäºº',desc:'ç‰ºç‰²ã€è§†è§’è½¬æ¢ã€ç­‰å¾…'},
      {id:13,name:'æ­»ç¥',desc:'ç»“æŸã€èœ•å˜ã€æ–°ç”Ÿ'},
      {id:14,name:'èŠ‚åˆ¶',desc:'å¹³è¡¡ã€è°ƒå’Œã€è‡ªåˆ¶'},
      {id:15,name:'æ¶é­”',desc:'æŸç¼šã€æ¬²æœ›ã€è€ƒéªŒ'},
      {id:16,name:'å¡”',desc:'çªå˜ã€å´©åã€è§‰é†’'},
      {id:17,name:'æ˜Ÿæ˜Ÿ',desc:'å¸Œæœ›ã€ç–—æ„ˆã€æ„Ÿæ‚Ÿ'},
      {id:18,name:'æœˆäº®',desc:'å¹»æƒ³ã€æƒ…ç»ªã€ç›´è§‰'},
      {id:19,name:'å¤ªé˜³',desc:'æˆåŠŸã€å–œæ‚¦ã€æ´»åŠ›'},
      {id:20,name:'å®¡åˆ¤',desc:'è§‰é†’ã€å®¡è§†ã€å‘¼å”¤'},
      {id:21,name:'ä¸–ç•Œ',desc:'å®Œæˆã€æˆå°±ã€åœ†æ»¡'},
      {id:22,name:'æƒæ–A',desc:'æ–°æœºä¼šã€èƒ½é‡ã€èµ·å§‹'},
      {id:23,name:'æƒæ–2',desc:'åˆä½œã€è®¡åˆ’ã€è¿œæ™¯'},
      {id:24,name:'æƒæ–3',desc:'æˆé•¿ã€å»ºç«‹ã€è¿œè§'},
      {id:25,name:'æƒæ–4',desc:'åº†ç¥ã€ç¨³å®šã€å’Œè°'},
      {id:26,name:'æƒæ–5',desc:'å†²çªã€æŒ‘æˆ˜ã€ç«äº‰'},
      {id:27,name:'æƒæ–6',desc:'æˆåŠŸã€èƒœåˆ©ã€è®¤å¯'},
      {id:28,name:'æƒæ–7',desc:'é˜²å®ˆã€åšæŒã€å†³å¿ƒ'},
      {id:29,name:'æƒæ–8',desc:'æ€¥ä¿ƒã€è¡ŒåŠ¨ã€é€šä¿¡'},
      {id:30,name:'æƒæ–9',desc:'é˜²å¾¡ã€ç–²åŠ³ã€åšæŒ'},
      {id:31,name:'æƒæ–10',desc:'è´Ÿæ‹…ã€å®Œæˆã€å…´å¥‹'},
      {id:32,name:'æƒæ–J',desc:'çƒ­æƒ…ã€è‡ªç”±ã€å†’é™©ç²¾ç¥'},
      {id:33,name:'æƒæ–Q',desc:'çƒ­æƒ…ã€å¸å¼•ã€åˆ›æ„'},
      {id:34,name:'æƒæ–K',desc:'é¢†å¯¼ã€é­…åŠ›ã€ç»“è°Š'},
      {id:35,name:'æƒæ–ä¾è€…',desc:'ä¿¡æ¯ã€é€šä¿¡ã€å­¦ä¹ '},
      {id:36,name:'åœ£æ¯A',desc:'çˆ±ã€æ„Ÿå—ã€ç›´è§‰'},
      {id:37,name:'åœ£æ¯2',desc:'ä¼´ä¾£ã€äº²å¯†ã€äº’åŠ¨'},
      {id:38,name:'åœ£æ¯3',desc:'åº†ç¥ã€å‹è°Šã€ç¤¾äº¤'},
      {id:39,name:'åœ£æ¯4',desc:'å†·æ¼ ã€å¤±æœ›ã€é€€ç¼©'},
      {id:40,name:'åœ£æ¯5',desc:'é—æ†¾ã€å¤±è½ã€æ‚²ä¼¤'},
      {id:41,name:'åœ£æ¯6',desc:'æ€€æ—§ã€ç¾å¥½è®°å¿†ã€è‰ºæœ¯'},
      {id:42,name:'åœ£æ¯7',desc:'å¹»æƒ³ã€é€‰æ‹©ã€æœºä¼š'},
      {id:43,name:'åœ£æ¯8',desc:'æ”¾ä¸‹ã€ç§»åŠ¨ã€è¿œç¦»'},
      {id:44,name:'åœ£æ¯9',desc:'æ»¡è¶³ã€å–œæ‚¦ã€æˆå°±'},
      {id:45,name:'åœ£æ¯10',desc:'å®¶æ—ã€å¹¸ç¦ã€å®Œæ•´'},
      {id:46,name:'åœ£æ¯J',desc:'å¹´è½»ã€åˆ›æ„ã€æ•æ„Ÿ'},
      {id:47,name:'åœ£æ¯Q',desc:'ç›´è§‰ã€å…³æ€€ã€çˆ±'},
      {id:48,name:'åœ£æ¯K',desc:'æƒ…æ„Ÿã€å¯Œæœ‰åŒæƒ…å¿ƒã€å–„è‰¯'},
      {id:49,name:'åœ£æ¯ä¾è€…',desc:'é‚€è¯·ã€å»ºè®®ã€æ„Ÿå—'},
      {id:50,name:'å®å‰‘A',desc:'çœŸç†ã€æ–°æƒ³æ³•ã€å¼€å§‹'},
      {id:51,name:'å®å‰‘2',desc:'åœæ»ã€å›°å¢ƒã€å¹³è¡¡'},
      {id:52,name:'å®å‰‘3',desc:'æ‚²ä¼¤ã€åˆ†ç¦»ã€è‹¦éš¾'},
      {id:53,name:'å®å‰‘4',desc:'ä¼‘æ¯ã€æ²‰æ€ã€ä¼‘æˆ˜'},
      {id:54,name:'å®å‰‘5',desc:'å†²çªã€ç´§å¼ ã€å¤±è´¥'},
      {id:55,name:'å®å‰‘6',desc:'å‰è¿›ã€é€ƒè„±ã€æ—…è¡Œ'},
      {id:56,name:'å®å‰‘7',desc:'æ¬ºéª—ã€é˜´è°‹ã€å›°å¢ƒ'},
      {id:57,name:'å®å‰‘8',desc:'æŸç¼šã€é™·é˜±ã€æ— åŠ›'},
      {id:58,name:'å®å‰‘9',desc:'ç„¦è™‘ã€å™©æ¢¦ã€ç—›è‹¦'},
      {id:59,name:'å®å‰‘10',desc:'ç»“æŸã€ç—›è‹¦ã€å¤±è´¥'},
      {id:60,name:'å®å‰‘J',desc:'åˆ†æã€æ‰¹è¯„ã€å­¦ä¹ '},
      {id:61,name:'å®å‰‘Q',desc:'æ¸…æ™°ã€çœŸç†ã€ç‹¬ç«‹'},
      {id:62,name:'å®å‰‘K',desc:'æƒå¨ã€å…¬æ­£ã€ç†æ€§'},
      {id:63,name:'å®å‰‘ä¾è€…',desc:'ä¿¡æ¯ã€éªšä¹±ã€è­¦å‘Š'},
      {id:64,name:'é‡‘å¸A',desc:'å¯Œè¶³ã€æ–°æœºä¼šã€èµ„æº'},
      {id:65,name:'é‡‘å¸2',desc:'å¹³è¡¡ã€é€‚åº”ã€çµæ´»'},
      {id:66,name:'é‡‘å¸3',desc:'å›¢é˜Ÿã€åˆä½œã€æŠ€èƒ½'},
      {id:67,name:'é‡‘å¸4',desc:'æ‰€æœ‰ç‰©ã€ç¨³å®šã€è´¢å¯Œ'},
      {id:68,name:'é‡‘å¸5',desc:'å›°éš¾ã€å¤±ä¸šã€è´«å›°'},
      {id:69,name:'é‡‘å¸6',desc:'å…·æ…ˆã€ç»™äºˆã€äº¤æ¢'},
      {id:70,name:'é‡‘å¸7',desc:'è¯„ä¼°ã€ç­‰å¾…ã€æ”¶è·'},
      {id:71,name:'é‡‘å¸8',desc:'å·¥ä½œã€å­¦å¾’ã€ç»†èŠ‚'},
      {id:72,name:'é‡‘å¸9',desc:'å¯Œè¶³ã€çæƒœã€æ»¡è¶³'},
      {id:73,name:'é‡‘å¸10',desc:'é—äº§ã€å®¶åº­ã€ç»§æ‰¿'},
      {id:74,name:'é‡‘å¸J',desc:'å®ç”¨ã€å…³å¿ƒã€ä¿¡ä½¿'},
      {id:75,name:'é‡‘å¸Q',desc:'è‡ªç„¶ã€ä¸°å¯Œã€å…³æ€€'},
      {id:76,name:'é‡‘å¸K',desc:'å¯Œè£•ã€å®é™…ã€å•†ä¸š'},
      {id:77,name:'é‡‘å¸ä¾è€…',desc:'å­¦ä¹ ã€æœºä¼šã€æˆé•¿'},
    ];

    const READINGS = {
      love: {name:'ğŸ’— çˆ±æƒ…', interp:{ppp:'è¿™æ˜¯ä¸€ä¸ªéå¸¸ç§¯æçš„çˆ±æƒ…ä¿¡å·ï¼è¿‡å»çš„ç»å†è®©ä½ æˆé•¿ï¼Œç°åœ¨çš„ä½ å……æ»¡å¸å¼•åŠ›å’Œè‡ªä¿¡ï¼Œæœªæ¥å°†è¿æ¥ç¾å¥½çš„æ„Ÿæƒ…ã€‚ç›¸ä¿¡ç›´è§‰ï¼Œæ•å¼€å¿ƒæ‰‰ã€‚', ppn:'æ„Ÿæƒ…å‘å±•è‰¯å¥½ï¼Œä½†å¯èƒ½é¢ä¸´æ–°çš„æŒ‘æˆ˜æˆ–è½¬æŠ˜ã€‚è¿™å¯èƒ½æ˜¯è½¬å‘æ–°æ–¹å‘çš„æ—¶åˆ»ï¼Œåšå¥½å‡†å¤‡åº”å¯¹å˜åŒ–ã€‚', pnp:'è™½ç„¶å½“ä¸‹å¯èƒ½æœ‰äº›æ··ä¹±æˆ–å¤±æœ›ï¼Œä½†è¿™æ˜¯å¿…è¦çš„è¿‡ç¨‹ã€‚æœªæ¥ä¼šå¸¦æ¥æ–°çš„æœºé‡å’Œæ›´çœŸæŒšçš„è¿æ¥ã€‚åšæŒä¸€ä¸‹ã€‚', npp:'è¿‡å»çš„ä¼¤ç—›æ­£åœ¨æ„ˆåˆï¼Œç°åœ¨ä½ å¼€æ”¾å¿ƒæ‰‰ï¼Œæœªæ¥å°†å¸¦æ¥æ–°çš„æœºé‡å’Œæ›´å¥½çš„ç†è§£ã€‚è¿™æ˜¯ä¸€ä¸ªè½¬å˜çš„æ—¶æœŸï¼Œæ‹¥æŠ±æ–°çš„å¯èƒ½æ€§ã€‚', npn:'ç»å†äº†å›°éš¾ï¼Œä½†ç°åœ¨æœ‰æ‰€å¥½è½¬ã€‚ç»§ç»­æ”¹å–„ï¼Œæœªæ¥å°†æ›´ç¨³å®šå’Œå¹¸ç¦ã€‚', nnp:'è¿‡å»å¯èƒ½æœ‰äº›é—®é¢˜ï¼Œä½†ç°åœ¨æ”¹å–„äº†ã€‚ç»§ç»­ä¿ƒè¿›æ²Ÿé€šå’Œè”ç³»ï¼Œæœªæ¥ä¼šæ›´å¥½ã€‚', pnn:'è¿‡å»å¾ˆå¥½ï¼Œä½†å½“ä¸‹å¯èƒ½æœ‰äº›è°ƒæ•´ã€‚ä¿æŒä¿¡å¿ƒï¼Œæœªæ¥ä¼šå¸¦æ¥çªç ´ã€‚', nnn:'è¿™ä¸ªé˜¶æ®µå……æ»¡æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ˜¯å­¦ä¹ å’Œæˆé•¿çš„æœºä¼šã€‚è°ƒæ•´ç­–ç•¥ï¼Œç›¸ä¿¡å‰æ–¹çš„å…‰æ˜ã€‚'}},
      career: {name:'ğŸ’¼ äº‹ä¸š', interp:{ppp:'äº‹ä¸šè’¸è’¸æ—¥ä¸Šï¼è¿‡å»çš„åŠªåŠ›æ²¡æœ‰ç™½è´¹ï¼Œç°åœ¨çš„ä½ åœ¨æ­£ç¡®çš„è½¨é“ä¸Šï¼Œæœªæ¥å°†çœ‹åˆ°æ˜¾è‘—çš„æˆå°±å’ŒæˆåŠŸã€‚ç»§ç»­åŠªåŠ›ï¼', ppn:'èŒä¸šç”Ÿæ¶¯è‰¯å¥½ï¼Œä½†å¯èƒ½é¢ä¸´æ–°çš„æŒ‘æˆ˜æˆ–è½¬æŠ˜ã€‚è¿™å¯èƒ½æ˜¯è½¬å‘æ–°æ–¹å‘çš„æ—¶åˆ»ï¼Œåšå¥½å‡†å¤‡åº”å¯¹å˜åŒ–ã€‚', pnp:'å½“ä¸‹çš„èŒä¸šå›°å¢ƒæ˜¯æš‚æ—¶çš„ã€‚ä½ çš„åŸºç¡€å¾ˆæ‰å®ï¼Œé€šè¿‡åšæŒå’Œé€‚åº”ï¼Œæœªæ¥ä¼šè¿æ¥çªç ´å’Œæœºé‡ã€‚', npp:'ä½ æ­£åœ¨å…‹æœèŒä¸šçš„å›°éš¾ï¼Œç°åœ¨çŠ¶å†µåœ¨æ”¹å–„ã€‚ç»§ç»­è¿™ä¸ªåŠ¿å¤´ï¼Œæœªæ¥å°†å¸¦æ¥ç¨³å®šå’Œè¿›æ­¥ã€‚', npn:'ç»å†äº†å›°éš¾ï¼Œä½†ç°åœ¨æœ‰æ‰€å¥½è½¬ã€‚ç»§ç»­æ”¹å–„ï¼Œæœªæ¥å°†æ›´æœ‰å‰æ™¯ã€‚', nnp:'è¿‡å»å¯èƒ½æœ‰äº›èŒä¸šæŒ‘æˆ˜ï¼Œä½†ç°åœ¨æ”¹å–„äº†ã€‚ç»§ç»­ä¿ƒè¿›æˆé•¿ï¼Œæœªæ¥ä¼šæ›´å¥½ã€‚', pnn:'è¿‡å»çš„åŸºç¡€è‰¯å¥½ï¼Œä½†å½“ä¸‹å¯èƒ½æœ‰äº›é˜»åŠ›ã€‚ä¿æŒä¿¡å¿ƒï¼Œæœªæ¥ä¼šå¸¦æ¥çªç ´ã€‚', nnn:'èŒä¸šé“è·¯å……æ»¡æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ˜¯å­¦ä¹ å’Œæˆé•¿çš„æœºä¼šã€‚è°ƒæ•´ç­–ç•¥ï¼Œç›¸ä¿¡å‰æ–¹çš„å…‰æ˜ã€‚'}},
      pet: {name:'ğŸ¾ å® ç‰©', interp:{ppp:'ä½ çš„å® ç‰©çŠ¶æ€å¾ˆå¥½ï¼è¿‡å»å»ºç«‹çš„è‰¯å¥½å…³ç³»ï¼Œç°åœ¨çš„å®ƒå¥åº·å¿«ä¹ï¼Œæœªæ¥å°†ç»§ç»­å¹¸ç¦ç›¸ä¼´ã€‚ç»§ç»­ç”¨å¿ƒç…§é¡¾å®ƒã€‚', ppn:'å® ç‰©æ•´ä½“çŠ¶å†µå¾ˆå¥½ï¼Œä½†éœ€è¦æ³¨æ„æ½œåœ¨çš„å¥åº·æˆ–è¡Œä¸ºé—®é¢˜ã€‚å®šæœŸæ£€æŸ¥å’Œé€‚å½“çš„è®­ç»ƒä¼šå¾ˆæœ‰å¸®åŠ©ã€‚', pnp:'å® ç‰©å¯èƒ½æœ€è¿‘æœ‰äº›ä¸é€‚æˆ–è°ƒçš®ï¼Œä½†è¿™æ˜¯æš‚æ—¶çš„ã€‚é€šè¿‡è€å¿ƒå’Œå…³çˆ±ï¼Œå®ƒä¼šæ¢å¤æ´»åŠ›å¹¶æ›´äº²è¿‘ã€‚', npp:'è¿‡å»å® ç‰©å¯èƒ½æœ‰äº›é—®é¢˜ï¼Œä½†ç°åœ¨çŠ¶å†µæ”¹å–„äº†ã€‚ç»§ç»­ä¿æŒè‰¯å¥½çš„æŠ¤ç†ä¹ æƒ¯ï¼Œæœªæ¥ä¼šæ›´å¥½ã€‚', npn:'ç»å†äº†å›°éš¾ï¼Œä½†ç°åœ¨æœ‰æ‰€å¥½è½¬ã€‚ç»§ç»­æ”¹å–„ï¼Œæœªæ¥ä¼šæ›´ç¨³å®šã€‚', nnp:'è¿‡å»å® ç‰©å¯èƒ½æœ‰äº›æŒ‘æˆ˜ï¼Œä½†ç°åœ¨æ”¹å–„äº†ã€‚ç»§ç»­ä¿æŒè‰¯å¥½ç…§é¡¾ï¼Œæœªæ¥ä¼šæ›´å¥åº·ã€‚', pnn:'è¿‡å»å¾ˆå¥½ï¼Œä½†å½“ä¸‹å¯èƒ½æœ‰äº›è°ƒæ•´ã€‚ä¿æŒè€å¿ƒå’Œå…³çˆ±ï¼Œæœªæ¥ä¼šæ¢å¤ã€‚', nnn:'å® ç‰©å¯èƒ½æ­£åœ¨ç»å†è½¬å˜æœŸï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚ç»§ç»­å…³æ³¨å’ŒæŠ¤ç†ï¼Œå®ƒä¼šé€‚åº”å¾—æ›´å¥½ã€‚'}},
      family: {name:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ äº²æƒ…', interp:{ppp:'å®¶åº­å…³ç³»è‰¯å¥½ï¼è¿‡å»çš„çº½å¸¦ä¾æ—§åšå›ºï¼Œç°åœ¨å……æ»¡æ¸©æš–å’Œè°ï¼Œæœªæ¥å®¶äººå°†æ›´äº²å¯†ã€‚çæƒœè¿™æ ·çš„æ—¶åˆ»ã€‚', ppn:'å®¶åº­åŸºç¡€ç¨³å›ºï¼Œä½†å¯èƒ½æœ‰äº›æ²Ÿé€šæˆ–ç†è§£çš„é—®é¢˜éœ€è¦è§£å†³ã€‚ä¸»åŠ¨å€¾å¬å’Œè¡¨è¾¾å°†åŒ–è§£ä»»ä½•éš”é˜‚ã€‚', pnp:'å½“ä¸‹å¯èƒ½æœ‰å®¶åº­æ‘©æ“¦æˆ–åˆ†æ­§ï¼Œä½†è¿™æ˜¯æ­£å¸¸çš„ã€‚é€šè¿‡åŠªåŠ›å’Œç†è§£ï¼Œå®¶åº­å…³ç³»å°†å˜å¾—æ›´å¼ºã€‚', npp:'è¿‡å»çš„å®¶åº­å›°éš¾æ­£åœ¨ç¼“è§£ï¼Œç°åœ¨çš„æ°›å›´æ”¹å–„äº†ã€‚ç»§ç»­ä¿ƒè¿›æ²Ÿé€šå’Œè”ç³»ï¼Œæœªæ¥å°†æ›´å’Œè°ã€‚', npn:'ç»å†äº†å®¶åº­å›°éš¾ï¼Œä½†ç°åœ¨æœ‰æ‰€ç¼“è§£ã€‚ç»§ç»­æ”¹å–„ï¼Œæœªæ¥å°†æ›´ç¨³å®šã€‚', nnp:'è¿‡å»çš„å®¶åº­å›°éš¾æ­£åœ¨æ”¹å–„ï¼Œç°åœ¨çŠ¶å†µå¥½è½¬äº†ã€‚ç»§ç»­åŠªåŠ›ä¿ƒè¿›è”ç³»ï¼Œæœªæ¥ä¼šæ›´å¥½ã€‚', pnn:'è¿‡å»å¾ˆå¥½ï¼Œä½†ç°åœ¨å¯èƒ½æœ‰äº›è°ƒæ•´éœ€è¦åº”å¯¹ã€‚ä¿æŒè€å¿ƒå’Œå¼€æ”¾ï¼Œæœªæ¥å°†æ›´å’Œè°ã€‚', nnn:'å®¶åº­æ­£åœ¨ç»å†æŒ‘æˆ˜ï¼Œä½†è¿™æ˜¯æˆé•¿çš„æœºä¼šã€‚ç»§ç»­ä¿ƒè¿›æ²Ÿé€šå’Œç†è§£ï¼Œå…‰æ˜å°±åœ¨å‰æ–¹ã€‚'}}
    };

    function shuffleArray(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function getCardSentiment(cardId){
      const negative = [15,16,39,40,52,53,54,56,57,58,59,68];
      return negative.includes(cardId) ? 'n' : 'p';
    }

    function getCardImageUrl(cardId) {
      const colors = ['FF6B6B','4ECDC4','45B7D1','FFA07A','98D8C8','F7DC6F','BB8FCE','85C1E2'];
      const color = colors[cardId % colors.length];
      return `images/card_${cardId}.jpg`;
    }

    const spreadEl = document.getElementById('spread');
    const logEl = document.getElementById('log');
    const drawBtn = document.getElementById('draw');
    const shuffleBtn = document.getElementById('shuffle');
    const revealAllBtn = document.getElementById('revealAll');
    const resetBtn = document.getElementById('reset');
    const readingEl = document.getElementById('reading');
    const readingContentEl = document.getElementById('readingContent');
    const tagDisplayEl = document.getElementById('tagDisplay');
    const bgMusic = document.getElementById('bgMusic');
    const musicBtn = document.getElementById('musicBtn');
    const musicStatus = document.getElementById('musicStatus');

    let deck = [];
    let currentDraw = [];
    let selectedTag = null;
    let revealedCount = 0;
    let isMusicPlaying = false;

    function buildDeck(){
      deck = shuffleArray(ALL_CARDS.map(c=>Object.assign({},c)));
      log('å·²æ´—ç‰Œ â€“ ç‰Œåº“å…± ' + deck.length + ' å¼  ');
    }

    function log(txt){
      logEl.textContent = txt;
    }

    buildDeck();

    // éŸ³ä¹æ§åˆ¶
    musicBtn.addEventListener('click', function(){
      if(isMusicPlaying){
        bgMusic.pause();
        isMusicPlaying = false;
        musicStatus.textContent = 'ğŸ”‡';
        musicBtn.textContent = 'ğŸ”Š éŸ³ä¹';
      } else {
        bgMusic.play().catch(()=>{
          musicStatus.textContent = 'âŒ';
          log('éŸ³ä¹åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥music.mp3æ–‡ä»¶');
        });
        isMusicPlaying = true;
        musicStatus.textContent = 'ğŸµ';
        musicBtn.textContent = 'ğŸ”Š éŸ³ä¹';
      }
    });

    // è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼ˆæŸäº›æµè§ˆå™¨å¯èƒ½å—é™ï¼‰
    window.addEventListener('load', function(){
      bgMusic.play().then(()=>{
        isMusicPlaying = true;
        musicStatus.textContent = 'ğŸµ';
      }).catch(()=>{
        isMusicPlaying = false;
        musicStatus.textContent = 'ğŸ”‡';
      });
    });

    // æ ‡ç­¾é€‰æ‹©
    document.querySelectorAll('.tag-btn').forEach(btn=>{
      btn.addEventListener('click', function(){
        document.querySelectorAll('.tag-btn').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        selectedTag = this.dataset.tag;
        tagDisplayEl.textContent = 'ä¸»é¢˜ï¼š' + READINGS[selectedTag].name;
        log('å·²é€‰æ‹©ä¸»é¢˜ â€“ ç°åœ¨æ´—ç‰Œå¹¶å¼€å§‹å åœ');
        readingEl.classList.remove('show');
      });
    });

    shuffleBtn.addEventListener('click', function(){
      if(!selectedTag){ log('è¯·å…ˆé€‰æ‹©å åœä¸»é¢˜ï¼'); return; }
      buildDeck();
      resetSpread();
    });

    resetBtn.addEventListener('click', function(){
      buildDeck();
      resetSpread();
      document.querySelectorAll('.tag-btn').forEach(b=>b.classList.remove('active'));
      selectedTag = null;
      tagDisplayEl.textContent = '';
      readingEl.classList.remove('show');
      log('å·²é‡ç½® â€“ å‡†å¤‡å°±ç»ª');
    });

    function resetSpread(){
      currentDraw = [];
      revealedCount = 0;
      document.querySelectorAll('.card').forEach(c=>{
        c.classList.remove('flipped');
        const front = c.querySelector('.card-front');
        front.querySelector('.card-title').textContent = 'æœªç¿»å¼€';
      });
      log('å·²é‡ç½® â€“ å‡†å¤‡æ–°ä¸€è½®å åœ');
    }

    drawBtn.addEventListener('click', function(){
      if(!selectedTag){ log('è¯·å…ˆé€‰æ‹©å åœä¸»é¢˜ï¼'); return; }
      if(deck.length < 3){ log('ç‰Œä¸å¤Ÿäº†ï¼Œè¯·å…ˆæ´—ç‰Œ'); return; }
      currentDraw = [];
      revealedCount = 0;
      const drawn = deck.splice(0,3);
      drawn.forEach(d=>{
        currentDraw.push({card:d, reversed: Math.random()<0.3});
      });
      const cards = Array.from(document.querySelectorAll('.card'));
      cards.forEach((el,idx)=>{
        el.classList.remove('flipped');
        setTimeout(()=>{
          el.style.transform = 'translateY(-6px)';
          setTimeout(()=>el.style.transform='translateY(0)',250);
        }, idx*180);
      });
      log('å·²æŠ½å–ä¸‰å¼ ç‰Œ â€“ ç‚¹å‡»å¡ç‰Œç¿»å¼€æŸ¥çœ‹å«ä¹‰');
      readingEl.classList.remove('show');
    });

    function revealCard(index){
      if(!currentDraw[index]) return;
      const slot = document.querySelectorAll('.card')[index];
      const front = slot.querySelector('.card-front');
      const img = front.querySelector('.card-image');
      const titleEl = front.querySelector('.card-title');
      const data = currentDraw[index];
      
      if(!slot.classList.contains('flipped')){
        revealedCount++;
      }
      
      img.src = getCardImageUrl(data.card.id);
      const posName = slot.dataset.pos === 'past' ? 'è¿‡å»' : (slot.dataset.pos === 'present' ? 'ç°åœ¨' : 'æœªæ¥');
      const name = data.card.name + (data.reversed ? 'ï¼ˆé€†ä½ï¼‰' : 'ï¼ˆæ­£ä½ï¼‰');
      titleEl.textContent = name;
      
      slot.classList.add('flipped');
      log(`${posName}ï¼š${data.card.name} ${data.reversed ? 'ï¼ˆé€†ä½ï¼‰' : 'ï¼ˆæ­£ä½ï¼‰'} â€“ ${data.card.desc}`);
      
      if(revealedCount===3){
        generateReading();
      }
    }

    revealAllBtn.addEventListener('click', function(){
      if(currentDraw.length<3){ log('è¯·å…ˆæŠ½ç‰Œ'); return; }
      document.querySelectorAll('.card').forEach((el,idx)=>{
        if(!el.classList.contains('flipped')){
          revealCard(idx);
        }
      });
    });

    function generateReading(){
      const sentiments = currentDraw.map(d=>getCardSentiment(d.card.id)).join('');
      const pattern = sentiments || 'ppp';
      const interp = READINGS[selectedTag].interp;
      const text = interp[pattern] || interp.ppp;
      
      readingContentEl.innerHTML = '<p>' + text + '</p><p style="margin-top:16px;font-size:13px;color:#9fb4d8"><strong>âœ¨ ä¸‰å¼ ç‰Œçš„å¯“æ„ï¼š</strong><br>' + 
        '<strong>è¿‡å»ï¼š</strong>' + currentDraw[0].card.name + ' ' + (currentDraw[0].reversed?'ï¼ˆé€†ä½ï¼‰':'ï¼ˆæ­£ä½ï¼‰') + ' â€“ ' + currentDraw[0].card.desc +
        '<br><strong>ç°åœ¨ï¼š</strong>' + currentDraw[1].card.name + ' ' + (currentDraw[1].reversed?'ï¼ˆé€†ä½ï¼‰':'ï¼ˆæ­£ä½ï¼‰') + ' â€“ ' + currentDraw[1].card.desc +
        '<br><strong>æœªæ¥ï¼š</strong>' + currentDraw[2].card.name + ' ' + (currentDraw[2].reversed?'ï¼ˆé€†ä½ï¼‰':'ï¼ˆæ­£ä½ï¼‰') + ' â€“ ' + currentDraw[2].card.desc + '</p>';
      
      readingEl.classList.add('show');
    }

    // å¡ç‰Œç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.card').forEach((card, idx) => {
      card.addEventListener('click', function(){
        if(currentDraw.length > 0){
          revealCard(idx);
        }
      });
    });
  </script>
</body>
</html>